# Fuzzing Workflow Diagrams

**Date**: 2025-10-29

---

## ç‰ˆæœ¬ 1: Overview - æ•´ä½“å·¥ä½œæµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          OSS-Fuzz-Gen Workflow                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¾“å…¥: Benchmark (project, function_signature)
  â”‚
  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 1: COMPILATION - ç”Ÿæˆå¯ç¼–è¯‘çš„ fuzz driver                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 1: Function Analyzer                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Query FuzzIntrospector (source code)                  â”‚      â”‚
â”‚  â”‚ â€¢ Analyze call sites (usage examples)                   â”‚      â”‚
â”‚  â”‚ â€¢ Iterative learning (max 20 examples)                  â”‚      â”‚
â”‚  â”‚ â€¢ Generate specification                                â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ Output: function_analysis (specification)              â”‚
â”‚           â–¼                                                         â”‚
â”‚  Step 2: Prototyper                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Receive specification                                  â”‚      â”‚
â”‚  â”‚ â€¢ Generate fuzz target source code                      â”‚      â”‚
â”‚  â”‚ â€¢ Output: C/C++ code with LLVMFuzzerTestOneInput       â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ Output: fuzz_target_source                             â”‚
â”‚           â–¼                                                         â”‚
â”‚  Step 3: Build                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Compile fuzz target                                    â”‚      â”‚
â”‚  â”‚ â€¢ Link with project libraries                           â”‚      â”‚
â”‚  â”‚ â€¢ Check compilation success                             â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”œâ”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚           â”‚                                         â”‚              â”‚
â”‚           â””â”€ Failed â”€â”                              â”‚              â”‚
â”‚                      â–¼                              â”‚              â”‚
â”‚             Step 4: Enhancer                        â”‚              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Analyze build errors                          â”‚      â”‚      â”‚
â”‚  â”‚ â€¢ Fix compilation issues                        â”‚      â”‚      â”‚
â”‚  â”‚ â€¢ Retry up to 3 times                          â”‚      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚           â”‚                                         â”‚              â”‚
â”‚           â”œâ”€ Fixed â”€â”€â”€â”€â”€â”€> Re-build                â”‚              â”‚
â”‚           â”‚                                         â”‚              â”‚
â”‚           â””â”€ Still failing after 3 retries â”€â”       â”‚              â”‚
â”‚                                             â”‚       â”‚              â”‚
â”‚                    Regenerate â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚              â”‚
â”‚                    (Prototyper, once)               â”‚              â”‚
â”‚                                                     â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                      â”‚
                                 Compilation Success  â”‚
                                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PHASE 2: OPTIMIZATION - æå‡ coverage å’Œä¿®å¤ bugs               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Step 5: Execution                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Run fuzz target (default: 60 seconds)                 â”‚      â”‚
â”‚  â”‚ â€¢ Collect coverage data                                 â”‚      â”‚
â”‚  â”‚ â€¢ Detect crashes                                        â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚           â–¼             â–¼             â–¼                           â”‚
â”‚      Has Crashes?  Low Coverage?  Good Results?                   â”‚
â”‚           â”‚             â”‚             â”‚                           â”‚
â”‚           â–¼             â–¼             â””â”€â”€â”€â”€> END (Success)         â”‚
â”‚  Step 6a:          Step 6b:                                        â”‚
â”‚  Crash Analyzer    Coverage Analyzer                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                   â”‚
â”‚  â”‚ Analyze  â”‚      â”‚ Analyze  â”‚                                   â”‚
â”‚  â”‚ crash    â”‚      â”‚ low cov  â”‚                                   â”‚
â”‚  â”‚ patterns â”‚      â”‚ reasons  â”‚                                   â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                                   â”‚
â”‚       â”‚                 â”‚                                          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚
â”‚             â–¼                                                       â”‚
â”‚  Step 7: Context Analyzer                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Synthesize crash + coverage analysis                  â”‚      â”‚
â”‚  â”‚ â€¢ Identify root causes                                  â”‚      â”‚
â”‚  â”‚ â€¢ Generate improvement suggestions                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â–¼                                                         â”‚
â”‚  Step 8: Enhancer                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ â€¢ Apply suggestions                                      â”‚      â”‚
â”‚  â”‚ â€¢ Improve fuzz target                                   â”‚      â”‚
â”‚  â”‚ â€¢ Iterate (max cycles)                                  â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                                                         â”‚
â”‚           â””â”€â”€â”€â”€> Re-build â”€â”€â”€â”€> Re-execute â”€â”€â”€â”                   â”‚
â”‚                                                â”‚                   â”‚
â”‚           Max iterations reached? â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜
                                                                  â”‚
                                                                  â–¼
                                                      Final fuzz target
```

**å…³é”®ç»„ä»¶**:
- **Supervisor**: åè°ƒå„èŠ‚ç‚¹ï¼Œå†³å®šä¸‹ä¸€æ­¥åŠ¨ä½œ
- **Function Analyzer**: åˆ†æ API è¯­ä¹‰ï¼Œç”Ÿæˆè§„èŒƒ
- **Prototyper**: å°†è§„èŒƒç¿»è¯‘æˆä»£ç 
- **Enhancer**: ä¿®å¤ç¼–è¯‘é”™è¯¯æˆ–ä¼˜åŒ–ä»£ç 
- **Build**: ç¼–è¯‘ fuzz target
- **Execution**: è¿è¡Œ fuzzing
- **Crash/Coverage/Context Analyzer**: åˆ†æç»“æœï¼ŒæŒ‡å¯¼ä¼˜åŒ–

---

## ç‰ˆæœ¬ 2: Long-term Memory äº¤äº’è¯¦ç»†å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Long-term Memory Integration                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Long-term Memory                              â”‚
â”‚                   (Knowledge Repository)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  archetypes/                    skeletons/                        â”‚
â”‚  â”œâ”€ stateless_parser.md         â”œâ”€ stateless_parser_skeleton.c  â”‚
â”‚  â”œâ”€ object_lifecycle.md         â”œâ”€ object_lifecycle_skeleton.c  â”‚
â”‚  â”œâ”€ state_machine.md            â”œâ”€ state_machine_skeleton.c     â”‚
â”‚  â”œâ”€ stream_processor.md         â”œâ”€ stream_processor_skeleton.c  â”‚
â”‚  â”œâ”€ round_trip.md               â”œâ”€ round_trip_skeleton.c        â”‚
â”‚  â””â”€ file_based.md               â””â”€ file_based_skeleton.c        â”‚
â”‚                                                                    â”‚
â”‚  pitfalls/                                                         â”‚
â”‚  â”œâ”€ initialization_errors.md                                      â”‚
â”‚  â”œâ”€ data_argument_errors.md                                       â”‚
â”‚  â”œâ”€ call_sequence_errors.md                                       â”‚
â”‚  â””â”€ resource_management.md                                        â”‚
â”‚                                                                    â”‚
â”‚  retrieval.py: KnowledgeRetriever                                â”‚
â”‚  â”œâ”€ get_archetype(name) â†’ markdown                               â”‚
â”‚  â”œâ”€ get_skeleton(name) â†’ C code                                  â”‚
â”‚  â”œâ”€ get_pitfall(name) â†’ markdown                                 â”‚
â”‚  â””â”€ get_bundle(name) â†’ {archetype, skeleton, pitfalls}          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                                 â”‚
             â”‚ æ£€ç´¢ 1                          â”‚ æ£€ç´¢ 2
             â”‚ (åŸºäºæ¨æ–­çš„ archetype)          â”‚ (åŸºäºæå–çš„ archetype)
             â”‚                                 â”‚
             â–¼                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FUNCTION ANALYZER                           â”‚                   â”‚
â”‚  (agent_graph/agents/langgraph_agent.py)    â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                   â”‚
â”‚  Phase 1: Initial Analysis                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Prompt: function_analyzer_initial_prompt.txt       â”‚         â”‚
â”‚  â”‚ Input:                                              â”‚         â”‚
â”‚  â”‚   - Function signature                              â”‚         â”‚
â”‚  â”‚   - Function source code                            â”‚         â”‚
â”‚  â”‚ Output: Initial understanding                       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â–¼                                                       â”‚
â”‚  Phase 2: Iterative Analysis (up to 20 examples)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Loop: For each call site example                   â”‚         â”‚
â”‚  â”‚   Prompt: function_analyzer_iteration_prompt.txt   â”‚         â”‚
â”‚  â”‚   Input:                                            â”‚         â”‚
â”‚  â”‚     - Call context (before/after code)             â”‚         â”‚
â”‚  â”‚     - Parameter setup                               â”‚         â”‚
â”‚  â”‚     - Return handling                               â”‚         â”‚
â”‚  â”‚   LLM accumulates insights in conversation         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Conversation history contains keywords:              â”‚
â”‚           â”‚ "create", "destroy", "lifecycle" ...                 â”‚
â”‚           â–¼                                                       â”‚
â”‚  Phase 3: Infer Archetype                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ _infer_archetype_from_history()                    â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ â€¢ Scan last 5 messages in conversation             â”‚         â”‚
â”‚  â”‚ â€¢ Count keyword matches:                           â”‚         â”‚
â”‚  â”‚   - "create", "destroy" â†’ object_lifecycle         â”‚         â”‚
â”‚  â”‚   - "stateless", "parse" â†’ stateless_parser        â”‚         â”‚
â”‚  â”‚   - "stream", "chunk" â†’ stream_processor           â”‚         â”‚
â”‚  â”‚ â€¢ Return highest-scoring archetype                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Inferred: archetype = "object_lifecycle"             â”‚
â”‚           â–¼                                                       â”‚
â”‚  Phase 4: Retrieve Knowledge â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”         â”‚
â”‚  â”‚ _retrieve_archetype_knowledge()                â”‚   â”‚         â”‚
â”‚  â”‚                                                 â”‚   â”‚         â”‚
â”‚  â”‚ retriever = KnowledgeRetriever()              â”‚   â”‚         â”‚
â”‚  â”‚ bundle = retriever.get_bundle("object_lifecycle") â”‚         â”‚
â”‚  â”‚                                                 â”‚   â”‚         â”‚
â”‚  â”‚ Returns:                                        â”‚   â”‚         â”‚
â”‚  â”‚ {                                               â”‚   â”‚         â”‚
â”‚  â”‚   'archetype': '# Object Lifecycle...',        â”‚   â”‚         â”‚
â”‚  â”‚   'skeleton': 'int LLVMFuzzer...',             â”‚   â”‚         â”‚
â”‚  â”‚   'pitfalls': {                                 â”‚   â”‚         â”‚
â”‚  â”‚     'initialization_errors': '...',            â”‚   â”‚         â”‚
â”‚  â”‚     'data_argument_errors': '...',             â”‚   â”‚         â”‚
â”‚  â”‚     'call_sequence_errors': '...',             â”‚   â”‚         â”‚
â”‚  â”‚     'resource_management': '...'               â”‚   â”‚         â”‚
â”‚  â”‚   }                                             â”‚   â”‚         â”‚
â”‚  â”‚ }                                               â”‚   â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Format knowledge into context string                 â”‚
â”‚           â–¼                                                       â”‚
â”‚  Phase 5: Generate Specification                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ Prompt: function_analyzer_final_summary_prompt.txt â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ Placeholders filled:                               â”‚         â”‚
â”‚  â”‚   {PROJECT_NAME}: "libgeos"                        â”‚         â”‚
â”‚  â”‚   {FUNCTION_SIGNATURE}: "GEOSGeom..."              â”‚         â”‚
â”‚  â”‚   {EXAMPLES_COUNT}: 15                             â”‚         â”‚
â”‚  â”‚   {ARCHETYPE_KNOWLEDGE}: â—„â”€â”€â”€ Injected here!       â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ Knowledge injected:                                â”‚         â”‚
â”‚  â”‚ """                                                â”‚         â”‚
â”‚  â”‚ # Relevant Pattern Knowledge                       â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## Archetype: object_lifecycle                     â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ {full archetype doc from memory}                   â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## Common Pitfalls                                 â”‚         â”‚
â”‚  â”‚ ### initialization_errors                          â”‚         â”‚
â”‚  â”‚ {first 500 chars}...                               â”‚         â”‚
â”‚  â”‚ ### data_argument_errors                           â”‚         â”‚
â”‚  â”‚ {first 500 chars}...                               â”‚         â”‚
â”‚  â”‚ ...                                                â”‚         â”‚
â”‚  â”‚ """                                                â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â–¼                                                       â”‚
â”‚  Output: Specification                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ ## 1. Archetype & Reference Template               â”‚         â”‚
â”‚  â”‚ Primary pattern: Object Lifecycle                  â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## 2. Preconditions                                â”‚         â”‚
â”‚  â”‚ MUST: obj != NULL                                  â”‚         â”‚
â”‚  â”‚ Evidence: Example #3, line 45                      â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## 3. Setup Sequence                               â”‚         â”‚
â”‚  â”‚ step1: obj = GEOSGeom_create()                     â”‚         â”‚
â”‚  â”‚ step2: GEOSGeom_process(obj, ...)                  â”‚         â”‚
â”‚  â”‚ step3: GEOSGeom_destroy(obj)                       â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## 4. Parameter Fuzzing Strategy                   â”‚         â”‚
â”‚  â”‚ ...                                                 â”‚         â”‚
â”‚  â”‚                                                     â”‚         â”‚
â”‚  â”‚ ## 5. Postconditions & Error Handling              â”‚         â”‚
â”‚  â”‚ if (!obj) return 0;                                â”‚         â”‚
â”‚  â”‚ ...                                                 â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                       â”‚
â”‚           â”‚ Specification saved to:                              â”‚
â”‚           â”‚ work_dirs/requirements/01.txt                        â”‚
â”‚           â–¼                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â”‚ State update: function_analysis = {...}
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PROTOTYPER                                                        â”‚
â”‚  (agent_graph/agents/langgraph_agent.py)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  Phase 1: Extract Archetype from Specification                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ _extract_archetype_from_analysis()                 â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Read specification text, find:                     â”‚           â”‚
â”‚  â”‚   Pattern 1: "Primary pattern: Object Lifecycle"   â”‚           â”‚
â”‚  â”‚   Pattern 2: "Archetype: Object Lifecycle"         â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Normalize:                                          â”‚           â”‚
â”‚  â”‚   "Object Lifecycle" â†’ "object_lifecycle"          â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ Extracted: archetype = "object_lifecycle"              â”‚
â”‚           â–¼                                                         â”‚
â”‚  Phase 2: Retrieve Skeleton â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”         â”‚
â”‚  â”‚ _retrieve_skeleton()                               â”‚ â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚ retriever = KnowledgeRetriever()                  â”‚ â”‚         â”‚
â”‚  â”‚ skeleton = retriever.get_skeleton("object_lifecycle") â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚ Returns:                                            â”‚ â”‚         â”‚
â”‚  â”‚ ```c                                                â”‚ â”‚         â”‚
â”‚  â”‚ // Object Lifecycle Skeleton                       â”‚ â”‚         â”‚
â”‚  â”‚ // Pattern: create â†’ use â†’ destroy                 â”‚ â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚ int LLVMFuzzerTestOneInput(...) {                  â”‚ â”‚         â”‚
â”‚  â”‚   if (size < MIN_SIZE) return 0;                   â”‚ â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚   OBJECT_TYPE *obj = OBJECT_CREATE();              â”‚ â”‚         â”‚
â”‚  â”‚   if (!obj) return 0;  // Postcondition check      â”‚ â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚   int ret = OBJECT_PROCESS(obj, data, size);       â”‚ â”‚         â”‚
â”‚  â”‚   if (ret < 0) goto cleanup;                       â”‚ â”‚         â”‚
â”‚  â”‚                                                     â”‚ â”‚         â”‚
â”‚  â”‚ cleanup:                                            â”‚ â”‚         â”‚
â”‚  â”‚   OBJECT_DESTROY(obj);                             â”‚ â”‚         â”‚
â”‚  â”‚   return 0;                                         â”‚ â”‚         â”‚
â”‚  â”‚ }                                                   â”‚ â”‚         â”‚
â”‚  â”‚ ```                                                 â”‚ â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ Format skeleton into markdown                          â”‚
â”‚           â–¼                                                         â”‚
â”‚  Phase 3: Generate Fuzz Target                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ Prompt: prototyper_prompt.txt                      â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Placeholders filled:                               â”‚           â”‚
â”‚  â”‚   {PROJECT_NAME}: "libgeos"                        â”‚           â”‚
â”‚  â”‚   {FUNCTION_NAME}: "GEOSGeom..."                   â”‚           â”‚
â”‚  â”‚   {FUNCTION_ANALYSIS}: {specification from above}  â”‚           â”‚
â”‚  â”‚   {SKELETON_CODE}: â—„â”€â”€â”€ Injected here!             â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Skeleton injected:                                 â”‚           â”‚
â”‚  â”‚ """                                                â”‚           â”‚
â”‚  â”‚ # Reference Skeleton (adapt this structure)        â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ ```c                                                â”‚           â”‚
â”‚  â”‚ {skeleton code from memory}                        â”‚           â”‚
â”‚  â”‚ ```                                                 â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Adapt this skeleton according to the               â”‚           â”‚
â”‚  â”‚ specification above.                               â”‚           â”‚
â”‚  â”‚ """                                                â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ Task:                                               â”‚           â”‚
â”‚  â”‚ 1. Use the Driver Skeleton from spec as base       â”‚           â”‚
â”‚  â”‚ 2. Follow Setup Sequence exactly                   â”‚           â”‚
â”‚  â”‚ 3. Add Precondition checks                         â”‚           â”‚
â”‚  â”‚ 4. Add Postcondition checks                        â”‚           â”‚
â”‚  â”‚ 5. Construct parameters per strategy               â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ LLM adapts skeleton:                                   â”‚
â”‚           â”‚ OBJECT_TYPE â†’ GEOSGeometry*                           â”‚
â”‚           â”‚ OBJECT_CREATE â†’ GEOSGeom_createFromWKT_r             â”‚
â”‚           â”‚ OBJECT_PROCESS â†’ GEOSNormalize_r                     â”‚
â”‚           â”‚ OBJECT_DESTROY â†’ GEOSGeom_destroy_r                  â”‚
â”‚           â–¼                                                         â”‚
â”‚  Output: Fuzz Target Source Code                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ #include <stddef.h>                                â”‚           â”‚
â”‚  â”‚ #include <stdint.h>                                â”‚           â”‚
â”‚  â”‚ #include <geos_c.h>                                â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ int LLVMFuzzerTestOneInput(const uint8_t *data,   â”‚           â”‚
â”‚  â”‚                             size_t size) {         â”‚           â”‚
â”‚  â”‚   if (size < 1) return 0;                          â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚   // Initialize context                            â”‚           â”‚
â”‚  â”‚   GEOSContextHandle_t ctx = GEOS_init_r();        â”‚           â”‚
â”‚  â”‚   if (!ctx) return 0;  // â† Postcondition check    â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚   // Create geometry from fuzz input               â”‚           â”‚
â”‚  â”‚   char *wkt = malloc(size + 1);                    â”‚           â”‚
â”‚  â”‚   if (!wkt) goto cleanup_ctx;                      â”‚           â”‚
â”‚  â”‚   memcpy(wkt, data, size);                         â”‚           â”‚
â”‚  â”‚   wkt[size] = '\0';                                â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚   GEOSGeometry *geom = GEOSGeomFromWKT_r(ctx, wkt);â”‚           â”‚
â”‚  â”‚   if (!geom) goto cleanup_wkt;  // â† Postcondition â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚   // Normalize geometry                            â”‚           â”‚
â”‚  â”‚   int ret = GEOSNormalize_r(ctx, geom);           â”‚           â”‚
â”‚  â”‚   if (ret < 0) goto cleanup_geom;  // â† Postcond.  â”‚           â”‚
â”‚  â”‚                                                     â”‚           â”‚
â”‚  â”‚ cleanup_geom:                                       â”‚           â”‚
â”‚  â”‚   GEOSGeom_destroy_r(ctx, geom);                   â”‚           â”‚
â”‚  â”‚ cleanup_wkt:                                        â”‚           â”‚
â”‚  â”‚   free(wkt);                                        â”‚           â”‚
â”‚  â”‚ cleanup_ctx:                                        â”‚           â”‚
â”‚  â”‚   GEOS_finish_r(ctx);                              â”‚           â”‚
â”‚  â”‚   return 0;                                         â”‚           â”‚
â”‚  â”‚ }                                                   â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚           â”‚                                                         â”‚
â”‚           â”‚ State update: fuzz_target_source = {...}              â”‚
â”‚           â–¼                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
        Build â†’ Execute â†’ ...
```

**å…³é”®äº¤äº’ç‚¹**:

1. **Function Analyzer â†’ Long-term Memory**:
   - æ—¶æœº: ç”Ÿæˆ final summary ä¹‹å‰
   - æ–¹æ³•: `_infer_archetype_from_history()` + `_retrieve_archetype_knowledge()`
   - è¾“å…¥: å¯¹è¯å†å²ï¼ˆå…³é”®è¯åŒ¹é…ï¼‰
   - è¾“å‡º: Archetype æ–‡æ¡£ + ç›¸å…³ pitfalls
   - æ³¨å…¥: `{ARCHETYPE_KNOWLEDGE}` å ä½ç¬¦

2. **Prototyper â†’ Long-term Memory**:
   - æ—¶æœº: ç”Ÿæˆä»£ç ä¹‹å‰
   - æ–¹æ³•: `_extract_archetype_from_analysis()` + `_retrieve_skeleton()`
   - è¾“å…¥: Specification æ–‡æœ¬ï¼ˆæ­£åˆ™æå–ï¼‰
   - è¾“å‡º: Skeleton ä»£ç æ¨¡æ¿
   - æ³¨å…¥: `{SKELETON_CODE}` å ä½ç¬¦

---

## å…³é”®ç‰¹æ€§

### 1. è‡ªåŠ¨æ¨æ–­ (Function Analyzer)
```python
# ä»å¯¹è¯ä¸­æ¨æ–­ archetype
keywords_found = scan_conversation([
    "create", "destroy", "lifecycle"  # â†’ object_lifecycle
])

# æ£€ç´¢å¯¹åº”çŸ¥è¯†
knowledge = memory.get_bundle("object_lifecycle")

# æ³¨å…¥åˆ° prompt
prompt += knowledge
```

### 2. æ˜¾å¼æå– (Prototyper)
```python
# ä» spec ä¸­æå– archetype
archetype = regex_search(spec, r"Primary pattern: (.+)")
# â†’ "Object Lifecycle" â†’ "object_lifecycle"

# æ£€ç´¢ skeleton
skeleton = memory.get_skeleton("object_lifecycle")

# æ³¨å…¥åˆ° prompt
prompt += skeleton
```

### 3. çŸ¥è¯†å¤ç”¨
```
Archetype å®šä¹‰ â”€â”€â”
Skeleton æ¨¡æ¿ â”€â”€â”€â”¼â”€â”€> Long-term Memory (å•ä¸€æ¥æº)
Pitfalls åˆ—è¡¨ â”€â”€â”€â”˜

Function Analyzer â”€â”€â”
Prototyper â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€> æ£€ç´¢çŸ¥è¯†ï¼ˆæŒ‰éœ€åŠ è½½ï¼‰
Enhancer (future) â”€â”€â”˜
```

---

## Token æµå‘

```
ä¼ ç»Ÿæ–¹å¼:
Prompt (3,000 tokens) â†’ LLM â†’ Output
  â””â”€ åŒ…å«å¤§é‡é€šç”¨çŸ¥è¯†ï¼ˆæ¯æ¬¡é‡å¤ï¼‰

Long-term Memory æ–¹å¼:
Prompt (1,000 tokens) + Retrieved Knowledge (300 tokens) â†’ LLM â†’ Output
  â””â”€ Prompt åªå…³æ³¨åˆ†æï¼ŒçŸ¥è¯†æŒ‰éœ€æ£€ç´¢

èŠ‚çœ: ~57% tokens per API
```

---

**è¿™å°±æ˜¯æˆ‘ä»¬å½“å‰çš„å®Œæ•´ workflowï¼** ğŸ‰

