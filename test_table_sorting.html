<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Table Sorting Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        
        .sortable-table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
        }

        .sortable-table th {
            background: #f9fafb;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #e5e7eb;
            cursor: pointer;
            transition: background-color 0.2s ease;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .sortable-table th:hover {
            background: #f3f4f6;
        }

        .sortable-table th:first-child {
            cursor: default;
        }

        .sortable-table th:first-child:hover {
            background: #f9fafb;
        }

        .sortable-table td {
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .table-index {
            color: #555;
            font-size: 12px;
            text-align: center;
        }

        .sortable-table th:after {
            content: ' \25be';
            color: #ccc;
        }

        .sortable-table th[data-sorted="asc"]:after {
            color: #000;
        }

        .sortable-table th[data-sorted="desc"]:after {
            content: ' \25b4';
            color: #000;
        }
    </style>
</head>
<body>
    <h1>Benchmark Table Sorting Test</h1>
    
    <div class="toc-section">
        <h2>Samples</h2>
        <table class="sortable-table">
            <thead>
                <tr>
                    <th></th>
                    <th>Sample</th>
                    <th>Status</th>
                    <th data-sort-number>Builds</th>
                    <th data-sort-number>Crashes</th>
                    <th data-sort-number>Potential Vulnerability</th>
                    <th>Diagnosis</th>
                    <th>Triage</th>
                    <th data-sort-number>Coverage</th>
                    <th data-sort-number>Line coverage diff</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td class="table-index">1</td>
                    <td data-sort-value="sample_a">Sample A</td>
                    <td data-sort-value="completed">Completed</td>
                    <td data-sort-value="1">True</td>
                    <td data-sort-value="0">False</td>
                    <td data-sort-value="0">False</td>
                    <td>None</td>
                    <td>None</td>
                    <td data-sort-value="85.6">85.6%</td>
                    <td data-sort-value="5.2">5.2%</td>
                </tr>
                <tr>
                    <td class="table-index">2</td>
                    <td data-sort-value="sample_b">Sample B</td>
                    <td data-sort-value="failed">Failed</td>
                    <td data-sort-value="0">False</td>
                    <td data-sort-value="1">True</td>
                    <td data-sort-value="1">True</td>
                    <td>Error</td>
                    <td>FP</td>
                    <td data-sort-value="45.2">45.2%</td>
                    <td data-sort-value="-2.1">-2.1%</td>
                </tr>
                <tr>
                    <td class="table-index">3</td>
                    <td data-sort-value="sample_c">Sample C</td>
                    <td data-sort-value="completed">Completed</td>
                    <td data-sort-value="1">True</td>
                    <td data-sort-value="0">False</td>
                    <td data-sort-value="0">False</td>
                    <td>None</td>
                    <td>None</td>
                    <td data-sort-value="92.8">92.8%</td>
                    <td data-sort-value="12.3">12.3%</td>
                </tr>
                <tr>
                    <td class="table-index">4</td>
                    <td data-sort-value="sample_d">Sample D</td>
                    <td data-sort-value="running">Running</td>
                    <td data-sort-value="1">True</td>
                    <td data-sort-value="1">True</td>
                    <td data-sort-value="0">False</td>
                    <td>Warning</td>
                    <td>TP</td>
                    <td data-sort-value="67.3">67.3%</td>
                    <td data-sort-value="8.7">8.7%</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script>
        // Table sorting functionality
        function initTableSorting() {
            const table = document.querySelector('.sortable-table');
            if (!table) return;

            const headers = table.querySelectorAll('th');
            const tbody = table.querySelector('tbody');
            
            // Set default sort on Coverage column (descending)
            const coverageHeader = Array.from(headers).find(th => th.textContent.trim() === 'Coverage');
            if (coverageHeader && tbody && tbody.children.length > 0) {
                sortTable(table, Array.from(headers).indexOf(coverageHeader), 'desc');
                coverageHeader.setAttribute('data-sorted', 'desc');
            }

            // Add click handlers to sortable headers
            headers.forEach((header, index) => {
                if (header.textContent.trim() && index > 0) { // Skip empty first column
                    header.style.cursor = 'pointer';
                    header.addEventListener('click', () => {
                        const currentSort = header.getAttribute('data-sorted');
                        const newSort = currentSort === 'asc' ? 'desc' : 'asc';
                        
                        // Clear all other sort indicators
                        headers.forEach(h => h.removeAttribute('data-sorted'));
                        
                        // Set new sort direction
                        header.setAttribute('data-sorted', newSort);
                        
                        // Perform sort
                        sortTable(table, index, newSort);
                    });
                }
            });
        }

        function sortTable(table, columnIndex, direction) {
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.children);
            
            const sortedRows = rows.sort((a, b) => {
                const aCell = a.children[columnIndex];
                const bCell = b.children[columnIndex];
                
                // Get sort value from data attribute or text content
                let aValue = aCell.getAttribute('data-sort-value') || aCell.textContent.trim();
                let bValue = bCell.getAttribute('data-sort-value') || bCell.textContent.trim();
                
                // Handle numeric columns
                const isNumeric = aCell.parentElement.parentElement.previousElementSibling
                    .children[columnIndex].hasAttribute('data-sort-number');
                
                if (isNumeric) {
                    aValue = parseFloat(aValue) || 0;
                    bValue = parseFloat(bValue) || 0;
                } else {
                    // Handle percentage values like "85.6%"
                    if (typeof aValue === 'string' && aValue.includes('%')) {
                        aValue = parseFloat(aValue.replace('%', '')) || 0;
                        bValue = parseFloat(bValue.replace('%', '')) || 0;
                    } else {
                        // String comparison (case-insensitive)
                        aValue = aValue.toString().toLowerCase();
                        bValue = bValue.toString().toLowerCase();
                    }
                }
                
                // Handle boolean values (for True/False columns)
                if (aValue === 'true' || aValue === 'false') {
                    aValue = aValue === 'true';
                    bValue = bValue === 'true';
                }
                
                // Compare values
                if (aValue < bValue) return direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            // Re-append sorted rows
            sortedRows.forEach(row => tbody.appendChild(row));
            
            // Update row index numbers
            updateRowIndices(tbody);
        }

        function updateRowIndices(tbody) {
            const rows = tbody.children;
            for (let i = 0; i < rows.length; i++) {
                const indexCell = rows[i].querySelector('.table-index');
                if (indexCell) {
                    indexCell.textContent = i + 1;
                }
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initTableSorting);
    </script>
</body>
</html>
